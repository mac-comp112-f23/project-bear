---
title: "BEARcode"
date: "2023-12-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# reminder to take out the libraries you aren't using when you see this 

library(sf)
library(dplyr)
library(stringr)
library(tidyverse)
library(tidyr)
library(tibble)
library(gt)
library(purrr)
library(lubridate)
library(ggplot2)
library(gridExtra)
library(grid)
library(ggspatial)
library(maps)
library(plotly)
library(leaflet)
library(tidytext)
library(caret)
library(tidymodels)
library(quanteda)
library(quanteda.textstats)
library(text2vec)
library(syuzhet)
library(ggpie)
library(wordcloud)
library(tm)
library(RColorBrewer)
library(rnaturalearth)

```

```{r}

# you have to put your local path here, because r studio times out if you try and get the raw file from github
# sorry

ratings <- read.csv("rating.csv")

news <- read.csv("data.csv", stringsAsFactors = FALSE)
```

```{r}

# aggregate and analyze data
sentiment_distribution <- ratings %>%
                          group_by(title_sentiment) %>%
                          summarise(count = n(), 
                                    percentage = (count / nrow(news)) * 100)


# print the distribution
print(sentiment_distribution)

```

```{r}

positive_news <- ratings[ratings$title_sentiment == "Positive", ]

```

```{r}

# reminder to ev that this is a renaming thing, you cannot run it twice 
positive_news <- positive_news %>% rename(country = category)
```


```{r}

colors <- c("#1E1E1E", "#273046", "#354823", "#4E2A1E", "#5F5647", "#9B110E",
                        "#A42820", "#CB2314", "#550307", "#0C1707")
neutrals <- c("#CEB175",  "#C18748", "#AC9765", "#b67c3b", "#AF4E24",
  "#D3D4D8")

sentiment_distribution <- data.frame(
  title_sentiment = c("Negative", "Neutral", "Positive"),
  count = c(8667141, 40736418, 5975801),
  percentage = c(8.667141, 40.736418, 5.975801)
)

# colors for each sentiment category 
# I know the way I've done color palettes is scuffed I will probably fix 
piecolors <- c("Negative" = "#A42820",  
               "Neutral" = "#FAD510",    
               "Positive" = "#273046")   


# ggpie3D package, see github
pie <- ggpie3D(data = sentiment_distribution, 
               group_key = "title_sentiment",
               fill_color = piecolors,
               camera_eye = c(0.5, 2, 3),
               tilt = 5, # camera angle 
               show_label = FALSE) # manually adding labels in the presentation


pie + theme_void() +
 theme(plot.background = element_rect(fill = "#fef8e0", color = NA))
```

```{r}

# number of positive news stories for each source
positive_news_count <- positive_news %>%
                          group_by(source_name) %>%
                          summarise(count = n()) %>%
                          arrange(desc(count))

top_positive_sources <- positive_news_count %>%
                          slice(1:10)

# Colors generated by ChatGPT 
# It understands colors and I don't

colors <- c(
    "#D85A5A",  # Lighter red (adjusted)
    "#CB2314",  # Bright red
    "#A42820",  # Darker red
    "#9B110E",  # Deep red
    "#BF4040",  # Medium red (adjusted)
    "#AB2B2B",  # Slightly darker red (adjusted)
    "#971717",  # Dark red (adjusted)
    "#830000",  # Darker red/burgundy (adjusted)
    "#6F0000",   # Deepest red/burgundy (adjusted)
    "#550307"  # Very dark red/burgundy
)

ggplot(top_positive_sources, aes(x = reorder(source_name, count), y = count, fill = source_name)) +
  geom_rect(xmin = -Inf, xmax = Inf, ymin = -Inf, ymax = Inf, fill = "#fef8e0") +  
  geom_bar(stat = "identity") +
  scale_fill_manual(values = colors) +
  labs(title = "", x = "", y = "") +  
  theme(
    plot.title = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1), 
    axis.text.y = element_text(),  
    axis.title.x = element_blank(),  
    axis.title.y = element_blank(), 
    panel.grid.major = element_blank(),  
    panel.grid.minor = element_blank(),
    plot.background = element_rect(fill = "#fef8e0", color = NA), 
    panel.background = element_rect(fill = "#fef8e0", color = NA)   
  )

```
```{r}

all_text <- paste(positive_news$title, collapse = " ")

# a text corpus
corpus <- Corpus(VectorSource(all_text))

# preprocess the text
corpus <- tm_map(corpus, content_transformer(tolower))
corpus <- tm_map(corpus, removePunctuation)
corpus <- tm_map(corpus, removeNumbers)
corpus <- tm_map(corpus, removeWords, stopwords("english"))

# by god this presentation WILL match

custom_colors <- c("#A42820", "#273046", "#FAD510")

# put corpus in the correct format for wordcloud
tdm <- TermDocumentMatrix(corpus)
m <- as.matrix(tdm)
word_freqs <- sort(rowSums(m), decreasing = TRUE)
words <- names(word_freqs)

set.seed(1234)  # for reproducibility
par(bg = "#fef8e0")  
wordcloud(words = words, freq = word_freqs, scale = c(3, 0.5), max.words = 100, random.order = FALSE,
          rot.per = 0.35, use.r.layout = FALSE, colors = custom_colors, bg = "#fef8e0")

```

```{r}
positive_news_count <- positive_news %>%
                          group_by(country) %>%
                          summarise(count = n())

# world countries data
world_countries <- ne_countries(scale = "medium", returnclass = "sf")

# merge with positive news count data
map_data <- merge(world_countries, positive_news_count, by.x = "name", by.y = "country")

ggplot() +
    geom_sf(data = world_countries, fill = "white", color = "black") +
    geom_sf(data = map_data, aes(size = count), color = "#FAD510", shape = 21, fill = "#FAD510", alpha = .7) +
    theme_minimal() +
    labs(title = "Geographical Distribution of Positive News", x = "", y = "") +
    theme(
      legend.position = "bottom",
      plot.background = element_rect(fill = "#fef8e0", color = NA), 
      panel.background = element_rect(fill = "#fef8e0", color = NA) 
    )

```